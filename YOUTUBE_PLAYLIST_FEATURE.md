# YouTube再生リスト管理機能

## 概要
イラスト学習XPシステムにYouTube再生リストを登録・再生できる機能を実装しました。
学習用のYouTubeプレイリストをシステム内で一元管理し、ホーム画面から直接アクセスできます。

---

## 実装内容

### 1. **データベース（models.py）**
新しい`YouTubePlaylist`モデルを追加：
- `playlist_id` - YouTubeプレイリストID（一意）
- `title` - プレイリストのタイトル
- `description` - プレイリストの説明
- `thumbnail_url` - サムネイル（将来の拡張用）
- `added_date` - 登録日時

### 2. **バックエンド（app.py）**

#### エンドポイント追加

**POST `/youtube_playlist_process`**
- YouTubeプレイリストを登録・更新します
- URLまたはプレイリストID（PLxxxxxx）に対応
- 自動的にプレイリストIDを抽出

**POST `/delete_youtube_playlist/<id>`**
- 登録済みプレイリストを削除します

#### ヘルパー関数

**`extract_playlist_id(url_or_id)`**
- YouTubeのURLやプレイリストIDから、プレイリストIDを抽出
- 対応形式：
  - `https://www.youtube.com/playlist?list=PLxxxxxx`
  - `PLxxxxxx` （IDのみ）

#### データ取得

- `admin()` ビュー：管理画面に `youtube_playlists` を渡す
- `index()` ビュー：ホーム画面に `youtube_playlists` を渡す

### 3. **管理画面UI（admin.html）**

**新規タブ：「🎬 YouTube再生リスト」**

機能：
- ✅ プレイリスト登録/更新フォーム
  - プレイリストID/URL入力
  - タイトル（自動生成可）
  - 説明・メモ
  
- ✅ 登録済みプレイリスト一覧（テーブル）
  - 各プレイリストへのリンク表示
  - 編集ボタン
  - 削除ボタン

- ✅ 編集機能（JavaScript）
  - テーブル行をクリック → フォームに自動入力
  - 更新/キャンセルボタンの切り替え

### 4. **ホーム画面UI（index.html）**

**新規セクション：「🎬 YouTube学習プレイリスト」**

表示内容：
- グリッドレイアウト（レスポンシブ対応）
- 各プレイリストの：
  - タイトル
  - 説明
  - 「▶ 再生リストを開く」ボタン

- YouTubeの公式埋め込みで直接再生も可能（オプション）

---

## 使用方法

### 1. プレイリストを登録

1. **管理コンソール** → 「🎬 YouTube再生リスト」タブをクリック
2. プレイリストID/URLを入力
   - 例：`https://www.youtube.com/playlist?list=PLxxxxxx`
   - または単に `PLxxxxxx`
3. タイトル・説明を入力（タイトルは省略可）
4. 「プレイリストを登録」をクリック

### 2. ホーム画面で確認

1. **ホーム画面** をリロード
2. 「🎬 YouTube学習プレイリスト」セクションに登録済みプレイリストが表示
3. 「▶ 再生リストを開く」をクリック → YouTubeで再生

### 3. プレイリストを編集・削除

1. 管理画面の「🎬 YouTube再生リスト」タブで登録済み一覧を表示
2. **編集**：行をクリック → フォームに自動入力 → 修正 → 「プレイリストを更新」
3. **削除**：「削除」ボタン → 確認 → 完了

---

## 実装の特徴

✅ **URL/IDの自動抽出**  
　URLの形式に関わらず、プレイリストIDを自動抽出して保存

✅ **レスポンシブ対応**  
　グリッドレイアウトでPCからスマホまで対応

✅ **シンプルなUI**  
　既存デザインと統一、操作が直感的

✅ **スケーラブル設計**  
　`thumbnail_url` フィールドで将来の拡張（サムネイル表示など）に対応

---

## 技術スタック

- **言語**: Python (Flask)
- **DB**: SQLite + SQLAlchemy
- **フロントエンド**: HTML/CSS/JavaScript
- **正規表現**: YouTube URL/IDの抽出に使用

---

## ファイル修正一覧

| ファイル | 変更内容 |
|---------|---------|
| `models.py` | YouTubePlaylist モデル追加 |
| `app.py` | YouTube関連エンドポイント追加、ビューにデータ渡す |
| `templates/admin.html` | YouTube再生リスト管理タブ追加、編集JS実装 |
| `templates/index.html` | ホーム画面にプレイリスト表示セクション追加 |

---

## 今後の拡張案

- 📺 **YouTube埋め込み再生**: `<iframe>` でシステム内での再生
- 🎥 **複数プレイリスト分類**: カテゴリ・タグ付け
- 💾 **視聴履歴**: 再生したプレイリストをトラッキング
- ⭐ **お気に入り管理**: プレイリストのブックマーク
- 🔄 **キャッシング**: API未使用（静的IDのみ保持）で軽量化

---

## トラブルシューティング

### Q1: プレイリストが登録されない
→ YouTubeプレイリストIDが正確か確認  
→ URL形式: `?list=PLxxxxxx` の部分のみコピーしてみて

### Q2: 管理画面に表示されない
→ キャッシュをクリア（Ctrl+F5 / Cmd+Shift+R）  
→ ブラウザの再読み込み

### Q3: 削除がうまくいかない
→ 確認ダイアログを確認  
→ ブラウザコンソール（F12）でエラーを確認

---

## 仕様

- **プレイリストID形式**: `PL` または `RD` で始まる26文字のBase64風ID
- **重複登録**: 同じプレイリストIDは重複登録できません
- **URL形式**: 複数のパラメータがあってもリスト名前を抽出可能
